<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>DIGIY PRO CHAT — Realtime Engine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root{
      --bg:#020617;
      --bg-soft:#02081a;
      --accent:#f97316;
      --accent-gold:#facc15;
      --text:#e5e7eb;
      --muted:#9ca3af;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      min-height:100vh;
      background:radial-gradient(circle at top,#0b1120,#020617 60%);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
    }

    .shell{
      width:100%;
      max-width:480px;
      background:rgba(2,6,23,0.96);
      border-radius:22px;
      box-shadow:0 24px 70px rgba(0,0,0,0.85);
      border:1px solid rgba(148,163,184,0.3);
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    .header{
      padding:12px 16px;
      display:flex;
      align-items:center;
      gap:10px;
      border-bottom:1px solid rgba(148,163,184,0.25);
      background:linear-gradient(135deg,#020617,#0b1120);
    }

    .avatar{
      width:36px;height:36px;border-radius:999px;
      background:radial-gradient(circle,#fed7aa,#f97316);
      display:flex;align-items:center;justify-content:center;
      font-weight:800;font-size:18px;color:#111827;
    }

    .head-meta{flex:1;display:flex;flex-direction:column;gap:2px;}
    .head-title{font-size:15px;font-weight:800;text-transform:uppercase;}
    .head-sub{font-size:11px;color:var(--muted);}

    #chatMessages{
      flex:1;padding:12px;overflow-y:auto;display:flex;
      flex-direction:column;gap:6px;scroll-behavior:smooth;
    }

    .msg-row{display:flex;width:100%;}
    .msg-row.pro{justify-content:flex-end;}
    .msg-row.user{justify-content:flex-start;}

    .bubble{
      max-width:75%;padding:10px 14px;border-radius:16px;
      font-size:14px;line-height:1.4;white-space:pre-wrap;
    }

    .bubble.pro{
      background:linear-gradient(135deg,#f97316,#facc15);
      color:#111827;border-bottom-right-radius:5px;
    }

    .bubble.user{
      background:#02081a;color:#e5e7eb;
      border:1px solid rgba(148,163,184,0.35);
      border-bottom-left-radius:5px;
    }

    .bubble-meta{font-size:10px;color:var(--muted);margin-top:2px;text-align:right;}

    .footer{
      border-top:1px solid rgba(148,163,184,0.25);
      padding:8px;display:flex;align-items:center;gap:8px;
      background:#020617;
    }

    #messageInput{
      flex:1;padding:10px 14px;border-radius:999px;
      border:1px solid rgba(148,163,184,0.4);
      background:#02081a;color:var(--text);font-size:14px;
    }

    #sendBtn{
      padding:10px 16px;border-radius:999px;border:none;
      font-weight:700;font-size:11px;text-transform:uppercase;
      background:linear-gradient(135deg,#f97316,#facc15);
      color:#111827;cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="shell">

    <div class="header">
      <div class="avatar">P</div>
      <div class="head-meta">
        <div class="head-title">DIGIY PRO CHAT</div>
        <div class="head-sub">Chat en direct</div>
      </div>
    </div>

    <div id="chatMessages"></div>

    <div class="footer">
      <input id="messageInput" type="text" placeholder="Réponds au client..." autocomplete="off">
      <button id="sendBtn">Envoyer</button>
    </div>

  </div>

  <script type="module">
    // ----------------------------
    // IMPORTS FIREBASE SDK
    // ----------------------------
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      onChildAdded,
      update,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    // ----------------------------
    // TA CONFIG FIREBASE INTÉGRÉE
    // ----------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyBqEQWoE2iC7_rp-u4riilNVHolcP2o0B0",
      authDomain: "digiylyfe-ecosystem.firebaseapp.com",
      databaseURL: "https://digiylyfe-ecosystem-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "digiylyfe-ecosystem",
      storageBucket: "digiylyfe-ecosystem.firebasestorage.app",
      messagingSenderId: "1007962643384",
      appId: "1:1007962643384:web:20d26881e87f0dc37d0d4d"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // ----------------------------
    // PARAMETRES DU CHAT
    // ----------------------------
    const CHAT_ID = "exemple-chat-1";
    const PRO_ID  = "PRO_UID_001";

    // ----------------------------
    // UI SELECTORS
    // ----------------------------
    const chatMessagesEl = document.getElementById("chatMessages");
    const inputEl        = document.getElementById("messageInput");
    const sendBtn        = document.getElementById("sendBtn");

    // ----------------------------
    // FONCTIONS
    // ----------------------------
    function renderMessage(msg){
      const isPro = msg.senderType === "pro";

      const row = document.createElement("div");
      row.className = "msg-row " + (isPro ? "pro" : "user");

      const bubble = document.createElement("div");
      bubble.className = "bubble " + (isPro ? "pro" : "user");
      bubble.textContent = msg.text;

      const meta = document.createElement("div");
      meta.className = "bubble-meta";
      if (msg.timestamp){
        const d = new Date(msg.timestamp);
        meta.textContent = d.getHours().toString().padStart(2,"0") + ":" +
                           d.getMinutes().toString().padStart(2,"0");
      }

      const wrap = document.createElement("div");
      wrap.appendChild(bubble);
      wrap.appendChild(meta);

      row.appendChild(wrap);
      chatMessagesEl.appendChild(row);

      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    // ----------------------------
    // LECTURE TEMPS RÉEL
    // ----------------------------
    const msgRef = ref(db, `chat/${CHAT_ID}/messages`);

    onChildAdded(msgRef, (snap)=>{
      const msg = snap.val();
      if (msg) renderMessage(msg);
    });

    // ----------------------------
    // ENVOI MESSAGE
    // ----------------------------
    async function sendMessage(){
      const text = inputEl.value.trim();
      if (!text) return;

      const now = Date.now();

      await push(msgRef, {
        senderId: PRO_ID,
        senderType: "pro",
        text,
        timestamp: now
      });

      await update(ref(db, `chat/${CHAT_ID}`), {
        lastMessageAt: serverTimestamp()
      });

      inputEl.value = "";
      inputEl.focus();
    }

    sendBtn.addEventListener("click", sendMessage);
    inputEl.addEventListener("keydown", (e)=>{
      if (e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        sendMessage();
      }
    });

  </script>

</body>
</html>
