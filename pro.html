<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>DIGIY PRO CHAT â€” Canal client WhatsApp & Appels</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#020617">

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@600;800;900&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root{
            --bg:#020617;
            --ink:#f9fafb;
            --muted:#9ca3af;
            --accent:#f97316;
            --accent-wa:#22c55e;
        }

        *{margin:0;padding:0;box-sizing:border-box;}
        body{
            background:#020617;
            color:#f9fafb;
            font-family:'Manrope',sans-serif;
            display:flex;
            justify-content:center;
            padding:20px;
        }

        .app{
            width:100%;
            max-width:1200px;
            background:#08101f;
            border:1px solid #1e293b;
            border-radius:18px;
            overflow:hidden;
        }

        header{
            padding:20px;
            border-bottom:1px solid #1e293b;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }

        .brand{
            display:flex;
            align-items:center;
            gap:12px;
        }

        .brand-logo{
            width:42px;height:42px;
            border-radius:16px;
            font-size:1.4rem;
            font-weight:900;
            background:conic-gradient(#f97316,#facc15,#f97316);
            display:flex;justify-content:center;align-items:center;
            color:#020617;
        }

        .layout{
            display:grid;
            grid-template-columns:0.9fr 1.4fr;
            min-height:500px;
        }

        .sidebar{
            border-right:1px solid #1e293b;
            padding:20px;
        }

        .chat-item{
            padding:12px;
            background:#0f172a;
            border-radius:12px;
            margin-bottom:12px;
            display:flex;
            align-items:center;
            gap:12px;
        }

        .chat-avatar{
            width:32px;height:32px;
            background:radial-gradient(#f97316,#facc15);
            border-radius:12px;
            color:#000;
            display:flex;justify-content:center;align-items:center;
            font-weight:800;
        }

        .main{
            padding:20px;
            display:flex;
            flex-direction:column;
        }

        .messages{
            flex:1;
            overflow-y:auto;
            padding-right:10px;
            margin-bottom:20px;
        }

        .msg{
            padding:12px 16px;
            border-radius:12px;
            max-width:70%;
            margin-bottom:12px;
            background:#0f172a;
        }

        .msg.pro{
            background:#f97316;
            color:#020617;
            margin-left:auto;
        }

        .input-bar{
            padding:18px;
            border-top:1px solid #1e293b;
            display:flex;
            gap:10px;
        }

        .input-fake{
            flex:1;
            background:#0f172a;
            padding:12px 16px;
            border-radius:999px;
            color:#9ca3af;
        }
    </style>
</head>

<body>

<div class="app">

    <header>
        <div class="brand">
            <div class="brand-logo">D</div>
            <div>
                <div style="font-size:1.3rem;font-weight:900;">DIGIY PRO CHAT</div>
                <div style="font-size:0.75rem;color:#9ca3af;">WhatsApp â€¢ Appels â€¢ Historique</div>
            </div>
        </div>

        <div style="display:flex;gap:10px;">
            <div style="padding:6px 14px;border:1px solid #334155;border-radius:999px;">âš¡ DÃ©mo</div>
            <div style="padding:6px 14px;border:1px solid #334155;border-radius:999px;">ðŸŸ¢ En ligne</div>
        </div>
    </header>

    <div class="layout">

        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="chat-item">
                <div class="chat-avatar">F</div>
                <div>Fama K. (Nouveau client)</div>
            </div>

            <div class="chat-item">
                <div class="chat-avatar">M</div>
                <div>Modou F. (AIBD â†’ Saly)</div>
            </div>

            <div class="chat-item">
                <div class="chat-avatar">A</div>
                <div>AÃ¯sha N. (Retour hÃ´tel)</div>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main">

            <div style="font-size:1.1rem;font-weight:700;margin-bottom:6px;">
                Fama K. â€” Transfert AIBD â†’ Saly
            </div>
            <div style="font-size:0.8rem;color:#9ca3af;margin-bottom:20px;">
                Dernier message il y a 2 min
            </div>

            <div class="messages" id="messages">
                <div class="msg">Bonjour Lamineâ€¦</div>
                <div class="msg pro">Salam Fama ðŸ‘‹</div>
            </div>

            <div class="input-bar">
                <div class="input-fake">Ã‰crire une rÃ©ponseâ€¦</div>
            </div>

        </main>

    </div>
</div>

<!-- ðŸ”¥ðŸ”¥ðŸ”¥ SCRIPT FIREBASE BRANCHÃ‰ SUR RIDE_001 ðŸ”¥ðŸ”¥ðŸ”¥ -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
    import {
        getDatabase,
        ref,
        push,
        set,
        update,
        serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBqEQWoE2iC7_rp-u4riilNVHolcP2o0B0",
        authDomain: "digiylyfe-ecosystem.firebaseapp.com",
        databaseURL: "https://digiylyfe-ecosystem-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "digiylyfe-ecosystem",
        storageBucket: "digiylyfe-ecosystem.firebasestorage.app",
        messagingSenderId: "1007962643384",
        appId: "1:1007962643384:web:20d26881e87f0dc37d0d4d"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // ðŸ†” On se branche sur TA course rÃ©elle
    const RIDE_ID = "RIDE_001";          // le salon chat = ride
    const PRO_ID  = "PRO_UID_002";       // driver
    const USER_ID = "USER_UID_001";      // passager

    async function sendDemoMessage() {
        const t = serverTimestamp();

        // ðŸ”„ Met Ã  jour le salon chat/RIDE_001
        await update(ref(db, `chat/${RIDE_ID}`), {
            proId: PRO_ID,
            userId: USER_ID,
            lastMessageAt: t
        });

        // ðŸ’¬ Ajoute un message
        const msgRef = push(ref(db, `chat/${RIDE_ID}/messages`));
        await set(msgRef, {
            from: "client",
            text: "Test DIGIY PRO CHAT liÃ© Ã  RIDE_001",
            at: t
        });

        console.log("ðŸ”¥ Message ajoutÃ© dans chat/RIDE_001 :", msgRef.key);
    }

    window.addEventListener("DOMContentLoaded", sendDemoMessage);
</script>

</body>
</html>
